<script src="https://unpkg.com/vue@3"></script>
<script src="./papaparse.min.js"></script>
<script src="./assets/contextMenu/contextMenu.js"></script>
<link rel="stylesheet" href="globalStylesheet.css">
<link rel="stylesheet" href="boxAStylesheet.css">
<link rel="stylesheet" href="boxBStylesheet.css">
<link rel="stylesheet" href="contextMenu.css">

<body>
  <div id="app" @click="hideMenu">
    <div class="outerDiv">
      <div class="innerDiv">
        <div class="boxA">
          <div @click="firstTabSelected=true" class="tab" :class="{ selectedTab: firstTabSelected}"><span class="topHeading">Urval</span></div>
          <div @click="firstTabSelected=false" class="tab" :class="{ selectedTab: !firstTabSelected, inactiveTab: g_expanded}"><span class="topHeading">Översikt</span></div>
          <div v-if="firstTabSelected" class="tabContent firstTabContent" :class="{ tabContentExpanded: g_expanded}">
            <div class="aboveLists heading">
              <span class="heading">Utdelningstillfälle</span><div class="fakeTimeSelectionBox">08:00 2022-03-04 <button>...</button></div>
              <img v-if="!g_expanded" @click="g_expanded = !g_expanded" id="G_expand" class="G" src="./assets/images/Expand.png"></img>
              <img v-else @click="g_expanded = !g_expanded" id="G_contract" class="G" src="./assets/images/contract.png"></img>
            </div>
            <div class="topList">
              <table class="list">
                <thead>
                <tr class="headerRow heading">
                  <th style="width:50ch; width: 40ch">Ordination</th>
                  <th style="width:35ch">Beredningsform</th>
                  <th style="width:20ch">Dos</th>
                  <th style="width:2em">Sta</th>
                  <th style="width:2em">G</th>
                  <th style="width:25ch">Info</th>
                  <th style="width:2em">Aut</th>
                  <th style="width:2em">Kyl</th>
                </tr>
              </thead>
              <tbody>
                <tr @click="selectRow(row)" @contextmenu.prevent="rightClick($event, row)" v-for="(row, index) in currentPatientMedicines_8oclock" :class="{ selectedRow: isSelectedRow(row) }" class="valueRow">
                  <td><div v-bind:title="row['Namn'] + ' ' + row['Styrka']" class="valueCell value">{{row['Namn'] + ' ' + row['Styrka']}}</div></td>
                  <td><div v-bind:title="row['Beredningsform']" class="valueCell value">{{row['Beredningsform, kortversion'] != '' ? row['Beredningsform, kortversion'] : row['Beredningsform']}}</div></td>
                  <td><div v-bind:title="this.currentPatientPrescriptions[index]['Dosering']" class="valueCell value">{{this.currentPatientPrescriptions[index]["Kortform Dosering"]}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Leveranstyp']==1 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_1.png">
                    <img v-if="row['Leveranstyp']==2 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_2.png">
                    <img v-if="row['Övrigt'] == 'Hoppa över'" height="18" src="./assets/images/A_Sta_3.png">
                    <img v-if="row['Övrigt'] == 'Avvakta'" height="18" src="./assets/images/A_Sta_4.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['G'] == 'G'" height="18" src="./assets/images/A_G_1.png">
                    <img v-if="row['G'] == 'g'" height="18" src="./assets/images/A_G_2.png">
                  </div></td>
                  <td><div v-bind:title="row['Info Långform']" class="valueCell value">{{row['Info']}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['I automat'] == '1'" height="18" src="./assets/images/A_Aut.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Kylförvaras'] == '1'" height="18" src="./assets/images/A_Kyl.png">
                  </div></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="bottomList">
            <table class="list">
              <thead>
                <tr class="headerRow heading">
                  <th style="width:50ch; width: 40ch">Ej tidssatta ordinationer</th>
                  <th style="width:35ch">Bered.form</th>
                  <th style="width:20ch">Dos</th>
                  <th style="width:2em">Sta</th>
                  <th style="width:2em">G</th>
                  <th style="width:25ch">Info</th>
                  <th style="width:2em">Aut</th>
                  <th style="width:2em">Kyl</th>
                </tr>
              </thead>
              <tbody>
                <tr @click="selectRow(row)" @contextmenu.prevent="rightClick($event, row)" v-for="(row, index) in currentPatientMedicines_noTime.concat(generalMedicines)" :class="{ selectedRow: isSelectedRow(row) }" class="valueRow">
                  <td><div v-bind:title="row['Namn'] + ' ' + row['Styrka']" class="valueCell value">{{row['Namn'] + ' ' + row['Styrka']}}</div></td>
                  <td><div v-bind:title="row['Beredningsform']" class="valueCell value">{{row['Beredningsform, kortversion'] != '' ? row['Beredningsform, kortversion'] : row['Beredningsform']}}</div></td>
                  <td><div v-bind:title="this.currentPatientPrescriptions_noTime.concat(generalPrescriptions)[index]['Dosering']" class="valueCell value">{{this.currentPatientPrescriptions_noTime.concat(generalPrescriptions)[index]["Kortform Dosering"]}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Leveranstyp']==1 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_1.png">
                    <img v-if="row['Leveranstyp']==2 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_2.png">
                    <img v-if="row['Övrigt'] == 'Hoppa över'" height="18" src="./assets/images/A_Sta_3.png">
                    <img v-if="row['Övrigt'] == 'Avvakta'" height="18" src="./assets/images/A_Sta_4.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['G'] == 'G'" height="18" src="./assets/images/A_G_1.png">
                    <img v-if="row['G'] == 'g'" height="18" src="./assets/images/A_G_2.png">
                  </div></td>
                  <td><div v-bind:title="row['Info Långform']" class="valueCell value">{{row['Info']}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['I automat'] == '1'" height="18" src="./assets/images/A_Aut.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Kylförvaras'] == '1'" height="18" src="./assets/images/A_Kyl.png">
                  </div></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div v-if="g_expanded" class="G-Content">
            <div v-for="(medicine, index) in currentPatientMedicines_8oclock.filter(med => med['G'] == 'g')">
              <span class="topHeading">{{ medicine['Namn'] }}</span>
              <table class="list">
                <thead>
                  <tr class="headerRow heading">
                    <th>Läkemedel</th>
                    <th>Platser</th>
                  </tr>
                  <tr v-for="(replacementMedicine, index) in getReplacingMedicines(medicine)" class="valueRow">
                    <td>
                      <div class="valueCell value">{{ replacementMedicine['Namn'] }}</div>
                    </td>
                    <td>
                      <div class="valueCell value">{{ replacementMedicine['Finns på'] }}</div>
                    </td>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
        <div v-else class="tabContent secondTabContent">
          <!-- TODO -->
        </div>
      </div>
      <div class="arrow">
        <img v-if="selectedRow != null" src="./assets/images/AtoB_arrow_active.png">
        <img v-else src="./assets/images/AtoB_arrow_inactive.png">
      </div>
      <div class="boxB">

      </div>
      <button id="administrationButton">Till Administrering</button>
    </div>
    <div id="contextMenu" class="context-menu" style="display: none">
      <ul class="menu">
        <li @click="rightClickedRow['Övrigt'] = 'Hoppa över'; hideMenu()"><a href="#">Hoppa över</a></li>
        <li @click="rightClickedRow['Övrigt'] = 'Avvakta'; hideMenu()"><a href="#">Avvakta</a></li>
      </ul>
    </div>
  </div>
</div>
<script src="./main.js"></script>
</body>