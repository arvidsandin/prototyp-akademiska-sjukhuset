<script src="https://unpkg.com/vue@3"></script>
<script src="./papaparse.min.js"></script>
<script src="./assets/contextMenu/contextMenu.js"></script>
<link rel="stylesheet" href="globalStylesheet.css">
<link rel="stylesheet" href="boxAStylesheet.css">
<link rel="stylesheet" href="boxBStylesheet.css">
<link rel="stylesheet" href="contextMenu.css">

<body>
  <div id="app" >
    <div class="outerDiv" @click="hideMenu">
      <div class="innerDiv">
        <div class="boxA">
          <div @click="firstTabSelected ? null: tab_click()" class="tab" :class="{ selectedTab: firstTabSelected}"><span class="topHeading">Urval</span></div>
          <div @click="firstTabSelected ? tab_click() : null" class="tab" :class="{ selectedTab: !firstTabSelected, inactiveTab: modalWindowIsUp }"><span class="topHeading">Översikt</span></div>
          <div v-if="firstTabSelected" class="tabContent firstTabContent" :class="{ tabContentExpanded: g_expanded}">
            <div class="aboveLists heading">
              <span class="heading">Utdelningstillfälle</span><div class="fakeTimeSelectionBox">08:00 2022-03-04 <button>...</button></div>
              <img v-if="!g_expanded" @click="G_click" id="G_expand" class="G" src="./assets/images/Expand.png"></img>
              <img v-else @click="G_click" id="G_contract" class="G" src="./assets/images/contract.png"></img>
            </div>
            <div class="topList">
              <table class="list">
                <thead>
                <tr class="headerRow heading">
                  <th style="width:50ch; width: 40ch">Ordination</th>
                  <th style="width:35ch; width:30ch">Beredningsform</th>
                  <th style="width:20ch">Dos</th>
                  <th style="width:2em">Sta</th>
                  <th style="width:2em">G</th>
                  <th style="width:25ch">Info</th>
                  <th style="width:2em">Aut</th>
                  <th style="width:2em">Kyl</th>
                </tr>
              </thead>
              <tbody>
                <tr @click="selectRow(row)" @contextmenu.prevent="rightClick($event, row)" v-for="(row, index) in currentPatientMedicines_8oclock" :class="{ selectedRow: isSelectedRow(row) }" class="valueRow">
                  <td><div v-bind:title="row['Namn'] + ' ' + row['Styrka']" class="valueCell value">{{row['Namn'] + ' ' + row['Styrka']}}</div></td>
                  <td><div v-bind:title="row['Beredningsform']" class="valueCell value">{{row['Beredningsform, kortversion'] != '' ? row['Beredningsform, kortversion'] : row['Beredningsform']}}</div></td>
                  <td><div v-bind:title="this.currentPatientPrescriptions[index]['Dosering']" class="valueCell value">{{this.currentPatientPrescriptions[index]["Kortform Dosering"]}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Leveranstyp']==1 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_1.png">
                    <img v-if="row['Leveranstyp']==2 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_2.png">
                    <img v-if="row['Övrigt'] == 'Kryssa'" height="18" src="./assets/images/A_Sta_3.png">
                    <img v-if="row['Övrigt'] == 'Avvakta'" height="18" src="./assets/images/A_Sta_4.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['G'] == 'G'" height="18" src="./assets/images/A_G_1.png">
                    <img v-if="row['G'] == 'g'" height="18" src="./assets/images/A_G_2.png">
                  </div></td>
                  <td><div v-bind:title="row['Info Långform']" class="valueCell value">{{row['Info']}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['I automat'] == '1'" height="18" src="./assets/images/A_Aut.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Kylförvaras'] == '1'" height="18" src="./assets/images/A_Kyl.png">
                  </div></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="bottomList">
            <table class="list">
              <thead>
                <tr class="headerRow heading">
                  <th style="width:50ch; width: 40ch">Ej tidssatta ordinationer</th>
                  <th style="width:35ch; width:30ch">Bered.form</th>
                  <th style="width:20ch">Dos</th>
                  <th style="width:2em">Sta</th>
                  <th style="width:2em">G</th>
                  <th style="width:25ch">Info</th>
                  <th style="width:2em">Aut</th>
                  <th style="width:2em">Kyl</th>
                </tr>
              </thead>
              <tbody>
                <tr @click="selectRow(row)" @contextmenu.prevent="rightClick($event, row)" v-for="(row, index) in currentPatientMedicines_noTime.concat(generalMedicines)" :class="{ selectedRow: isSelectedRow(row) }" class="valueRow">
                  <td><div v-bind:title="row['Namn'] + ' ' + row['Styrka']" class="valueCell value">{{row['Namn'] + ' ' + row['Styrka']}}</div></td>
                  <td><div v-bind:title="row['Beredningsform']" class="valueCell value">{{row['Beredningsform, kortversion'] != '' ? row['Beredningsform, kortversion'] : row['Beredningsform']}}</div></td>
                  <td><div v-bind:title="this.currentPatientPrescriptions_noTime.concat(generalPrescriptions)[index]['Dosering']" class="valueCell value">{{this.currentPatientPrescriptions_noTime.concat(generalPrescriptions)[index]["Kortform Dosering"]}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Leveranstyp']==1 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_1.png">
                    <img v-if="row['Leveranstyp']==2 && row['Övrigt'] == ''" height="18" src="./assets/images/A_Sta_2.png">
                    <img v-if="row['Övrigt'] == 'Kryssa'" height="18" src="./assets/images/A_Sta_3.png">
                    <img v-if="row['Övrigt'] == 'Avvakta'" height="18" src="./assets/images/A_Sta_4.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['G'] == 'G'" height="18" src="./assets/images/A_G_1.png">
                    <img v-if="row['G'] == 'g'" height="18" src="./assets/images/A_G_2.png">
                  </div></td>
                  <td><div v-bind:title="row['Info Långform']" class="valueCell value">{{row['Info']}}</div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['I automat'] == '1'" height="18" src="./assets/images/A_Aut.png">
                  </div></td>
                  <td><div class="valueCell valueCellImg value">
                    <img v-if="row['Kylförvaras'] == '1'" height="18" src="./assets/images/A_Kyl.png">
                  </div></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div v-if="g_expanded" class="G-Content">
            <div v-for="(medicine, index) in currentPatientMedicines_8oclock.filter(med => med['G'] == 'g')">
              <span class="topHeading">{{ medicine['Namn'] }}</span>
              <table class="list">
                <thead>
                  <tr class="headerRow heading">
                    <th>Läkemedel</th>
                    <th>Platser</th>
                  </tr>
                  <tr v-for="(replacementMedicine, index) in getReplacingMedicines(medicine)" class="valueRow">
                    <td>
                      <div class="valueCell value">{{ replacementMedicine['Namn'] }}</div>
                    </td>
                    <td>
                      <div class="valueCell value">{{ replacementMedicine['Finns på'] }}</div>
                    </td>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
        <div v-else class="tabContent secondTabContent">
          <!-- TODO -->
        </div>
      </div>
      <div class="arrow">
        <img v-if="selectedRow != null" src="./assets/images/AtoB_arrow_active.png">
        <img v-else src="./assets/images/AtoB_arrow_inactive.png">
      </div>
      <div class="boxB" :class="{ inactive: selectedRow == null}">
        <div v-if="selectedRow != null" class="boxBContent">
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Läkemedel</h1>
            <p class="value boxBData bold">{{ selectedRow['Namn'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Beredningsform</h1>
            <p class="value boxBData">{{ selectedRow['Beredningsform'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-1">
            <h1 class="heading boxBHeading">Styrka</h1>
            <p class="value boxBData">{{ selectedRow['Styrka'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-1">
            <h1 class="heading boxBHeading">Slutlig Konc</h1>
            <p class="value boxBData">{{ selectedRow.prescription['Koncentration av huvudsubstans i färdigspädd lösning'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-2">
            <h1 class="heading boxBHeading">Behandlingsorsak</h1>
            <p class="value boxBData">{{ selectedRow.prescription['Behandlingsorsak'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-2">
            <h1 class="heading boxBHeading">Hämtas Via</h1>
            <p v-if="selectedRow['Leveranstyp'] == '1'" class="value boxBData">Rörpost</p>
            <p v-else-if="selectedRow['Leveranstyp'] == '2'" class="value boxBData">Beredningsfarmaceut</p>
            <p v-else class="value boxBData">{{ selectedRow['I automat'] == '1' ? 'I automat' : 'Hylla/Vagn/Farmacet' }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-2">
            <h1 class="heading boxBHeading">Kylförvaring</h1>
            <p class="value boxBData">{{ selectedRow['Kylförvaras'] ? 'Ja' : 'Nej' }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Möjliga utbyten</h1>
            <div class="data_multipleLines">
              <p v-for="medicine in getReplacingMedicines(selectedRow)" class="value boxBData">
                {{ medicine['Namn'] }}
                {{ getPlaces_sorted(medicine).map(loc=>loc['Kortnamn']).join(', ') }}
              </p>
            </div>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Dosering</h1>
            <p class="value boxBData">{{ selectedRow.prescription['Dosering'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Administrationssätt</h1>
            <p class="value boxBData">{{ selectedRow.prescription['Administrationssätt'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Notera vid administrering</h1>
            <p class="value boxBData">{{ selectedRow.prescription['Notera vid administrering'] }}</p>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Ingående substanser</h1>
            <div class="data_multipleLines">
              <p v-for="prescription in prescriptions.filter(presc => presc['OrdinationsId'] == selectedRow.prescription['OrdinationsId'])" class="value boxBData">
                {{ prescription['(läkemedelsnamn)'] }}
                {{ prescription['Mängd som används vid spädning'] }}
              </p>
            </div>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Instruktioner för spädning/blandning</h1>
            <div class="data_multipleLines">
              <p class="value boxBData">{{ selectedRow.prescription['Instruktioner för spädning/blandning']}}</p>
            </div>
          </div>
          <div class="headingAndDataContainer grid-span-4">
            <h1 class="heading boxBHeading">Anteckning</h1>
            <div class="data_multipleLines">
              <p class="value boxBData anteckning">{{ selectedRow['Anteckning']}}</p>
              <button @click="note_click">Öppna</button>
            </div>
          </div>
          <button class="grid-span-2" @click="preparation_click">Iordningställ...</button>
          <button class="grid-span-1" @click="selectedRow['Övrigt'] = 'Kryssa'">Kryssa</button>
          <button class="grid-span-1" @click="selectedRow['Övrigt'] = 'Avvakta'">Avvakta</button>
          <div v-if="note_expanded" class="modalDialogueBox">
            <h1 class="heading bold">Anteckning</h1>
            <p id="note_editable" contenteditable="true" @input="noteEdited = true">{{ selectedRow['Anteckning'] }}</p>
            <div class="buttonContainer">
              <button v-if="noteEdited" @click="saveNote()">Spara</button>
              <button v-if="noteEdited" @click="closeNote()">Avbryt</button>
              <button v-if="!noteEdited" @click="closeNote()">Stäng</button>
            </div>
          </div>
          <div v-if="preparation_expanded" class="modalDialogueBox">
            <h1 class="heading bold">Iordningställande</h1>
    
          </div>
        </div>
      </div>
      <button id="administrationButton">Till Administrering</button>
    </div>
    <div id="contextMenu" class="context-menu" style="display: none">
      <ul class="menu heading">
        <li @click="rightClickedRow['Övrigt'] = 'Kryssa'; hideMenu()"><a href="#">Kryssa</a></li>
        <li @click="rightClickedRow['Övrigt'] = 'Avvakta'; hideMenu()"><a href="#">Avvakta</a></li>
      </ul>
    </div>
  </div>
</div>
<script src="./main.js"></script>
</body>